\documentclass[20pt,a0paper,portrait]{tikzposter}
%\documentclass[20pt,portrait,margin=5mm,innermargin=-4.5in,blockverticalspace=-0.25in]{tikzposter}
%\geometry{paperwidth=46.8in,paperheight=33.1in} % A0 = 1189 x 841 = 46.8 x 33.1
\usepackage[utf8]{inputenc}


% Beamer of stockholm
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{enumitem}
\setlist{nosep}
\usepackage[backend=biber,style=numeric]{biblatex}

% Gruvbox: https://github.com/morhetz/gruvbox
\usepackage{xcolor}
\definecolor{bluekeywords} {rgb}{0.13, 0.13, 1}
\definecolor{greencomments}{rgb}{0   , 0.5 , 0}
\definecolor{redstrings}   {rgb}{0.9 , 0,    0}
\definecolor{dark0hard}{HTML}{1d2021}
\definecolor{dark0}{HTML}{282828}  % Fg0
\definecolor{dark0soft}{HTML}{32302f}  % FG soft
\definecolor{dark1}{HTML}{3c3836}
\definecolor{dark2}{HTML}{504945}
\definecolor{dark3}{HTML}{665c54}
\definecolor{dark4}{HTML}{7c6f64}
\definecolor{dark4256}{HTML}{7c6f64}
\definecolor{gray245}{HTML}{928374}
\definecolor{gray244}{HTML}{928374}
\definecolor{light0hard}{HTML}{f9f5d7}
\definecolor{light0}{HTML}{fbf1c7}   % BG
\definecolor{light0soft}{HTML}{f2e5bc}
\definecolor{light1}{HTML}{ebdbb2}
\definecolor{light2}{HTML}{d5c4a1}
\definecolor{light3}{HTML}{bdae93}
\definecolor{light4}{HTML}{a89984}
\definecolor{light4256}{HTML}{a89984}
\definecolor{brightred}{HTML}{fb4934}
\definecolor{brightgreen}{HTML}{b8bb26}
\definecolor{brightyellow}{HTML}{fabd2f}
\definecolor{brightblue}{HTML}{83a598}
\definecolor{brightpurple}{HTML}{d3869b}
\definecolor{brightaqua}{HTML}{8ec07c}
\definecolor{brightorange}{HTML}{fe8019}
\definecolor{neutralred}{HTML}{cc241d}
\definecolor{neutralgreen}{HTML}{98971a}
\definecolor{neutralyellow}{HTML}{d79921}
\definecolor{neutralblue}{HTML}{458588}
\definecolor{neutralpurple}{HTML}{b16286}
\definecolor{neutralaqua}{HTML}{689d6a}
\definecolor{neutralorange}{HTML}{d65d0e}
\definecolor{fadedred}{HTML}{9d0006}
\definecolor{fadedgreen}{HTML}{79740e}
\definecolor{fadedyellow}{HTML}{b57614}
\definecolor{fadedblue}{HTML}{076678}
\definecolor{fadedpurple}{HTML}{8f3f71}
\definecolor{fadedaqua}{HTML}{427b58}
\definecolor{fadedorange}{HTML}{af3a03}

\definecolorstyle{tin} {
\definecolor{colorOne}{named}{fadedblue}
\definecolor{colorTwo}{named}{fadedyellow}
\definecolor{colorThree}{named}{fadedgreen}
}{
% Background Colors
\colorlet{backgroundcolor}{light0}
\colorlet{framecolor}{dark0}
% Title Colors
\colorlet{titlefgcolor}{dark0}
\colorlet{titlebgcolor}{light0}
% Block Colors
\colorlet{blocktitlebgcolor}{colorThree}
\colorlet{blocktitlefgcolor}{dark0}
\colorlet{blockbodybgcolor}{light0}
\colorlet{blockbodyfgcolor}{dark0}
% Innerblock Colors
\colorlet{innerblocktitlebgcolor}{light0}
\colorlet{innerblocktitlefgcolor}{dark0}
\colorlet{innerblockbodybgcolor}{colorThree!30!light0}
\colorlet{innerblockbodyfgcolor}{dark0}
% Note colors
\colorlet{notefgcolor}{dark0}
\colorlet{notebgcolor}{colorTwo!50!light0}
\colorlet{noteframecolor}{colorTwo}
}
\usecolorstyle{tin}

% Tikzposter
\defineblockstyle{tin}{
    titlewidthscale=1, bodywidthscale=1, titleleft,
    titleoffsetx=0pt, titleoffsety=0pt, bodyoffsetx=0pt, bodyoffsety=1mm,
    bodyverticalshift=0pt, roundedcorners=0, linewidth=2mm,
    titleinnersep=2mm, bodyinnersep=2mm
}{
}
\defineinnerblockstyle{tin}{
    titlewidthscale=1, bodywidthscale=1, titleleft,
    titleoffsetx=0pt, titleoffsety=0pt, bodyoffsetx=0pt, bodyoffsety=1mm,
    bodyverticalshift=0pt, roundedcorners=0, linewidth=2mm,
    titleinnersep=2mm, bodyinnersep=2mm
}{
}

\definelayouttheme{tin}{
    \usecolorstyle{tin}
    \usebackgroundstyle{Default}
    \usetitlestyle{Default}
    \useblockstyle{tin}
    \useinnerblockstyle{tin}
    \usenotestyle{Default}
}

\usetheme{tin}

% Color color
\usepackage{listings}
\lstset{
  basicstyle        = \ttfamily,
  language          = bash,
  showspaces        = false,
  showtabs          = false,
  breaklines        = true,
  showstringspaces  = false,
  breakatwhitespace = true,
  escapeinside      = {(*@}{@*)},
  commentstyle      = \color{fadedgreen},
  keywordstyle      = \color{fadedblue}\bfseries,
  stringstyle       = \color{fadedred},
  basicstyle        = \ttfamily,
  escapechar        = {`}
}

\usepackage{hyperref}

% Metadata
\title{Bash Programming}
%\author{Martin Tourneboeuf}
%\date{\today}
%\institute{ALMA}
% TODO logo upper right
%\titlegraphic{\includegraphics[width=0.06\textwidth]{../res/alma.png}}



\begin{filecontents*}[overwrite]{shbang.sh}
#!/usr/bin/env bash
print_hello_wold(){ echo "Hello, world!"; }
[[ "${BASH_SOURCE[0]}" == "$0" ]] && print_hello_world "$@"
\end{filecontents*}

\begin{filecontents*}[overwrite]{small_compgen.sh}
`\small{\# List command in scope with "corr" in their name}`
compgen -c | grep -i corr
\end{filecontents*}

\begin{filecontents*}[overwrite]{small_path.sh}
`\small{\# Print line separated PATH variable}`
echo "${PATH//:/$'\n'}"
\end{filecontents*}

\begin{filecontents*}[overwrite]{small_slurp.sh}
`\small{\# Slurp: file -> string}`
string=$(< file.txt )
\end{filecontents*}

\begin{filecontents*}[overwrite]{small.sh}
# TODO fill others
cmd <<< "string"  # Redirect a single line of text to the stdin ofcmd. This is called a here-string.
cmd1 | cmd2 | cmd3 | cmd; echo ${PIPESTATUS[@]}  # Find out the exit codes of all piped commands.
cmd <(cmd1) <(cmd2)  # Redirect stdout ofarguments tocmd. cmd1andcmd2to two anonymous fifos, then pass both fifos as
\end{filecontents*}

\begin{filecontents*}[overwrite]{variable.sh}
declare    `\color{dark0}\LARGE{string}`="a b"; echo "$string"
declare -i `\color{dark0}\LARGE{int}`=21; echo "$(( int * 2 ))"
declare -a `\color{dark0}\LARGE{array}`=(a "b c"); for string in "${array[@]}"; do echo "$string"; done
declare -A `\color{dark0}\LARGE{dict}`=([a]="b c" ["d e"]=f); for key in "${!dict[@]}"; do echo "$key: ${dict[$key]}"; done
\end{filecontents*}

\begin{filecontents*}[overwrite]{function.sh}
func(){
  for i; do echo "$((j++)): $i|"; done
}

func a "b c"
\end{filecontents*}

\begin{filecontents*}[overwrite]{grammar.sh}
echo "1 2" 3 | { cat -; help; }
for i in "1 2" 3; do echo "$i" | cat -; done



select name [ in word ] ; do list ; done
case word in [ [(] pattern [ | pattern ] ... ) list ;; ] ... esac
until list-1; do list-2; done
# word < expression < command < list
\end{filecontents*}

\begin{filecontents*}[overwrite]{condition.sh}
if true; then
  echo as simple as that
fi

if (( 1 > 1)); then echo no
elif [[ "$a" == toto ]]; then echo no
elif true; then echo yes
else echo no
fi

\end{filecontents*}

\begin{filecontents*}[overwrite]{loop.sh}
for string in a "b c"; do
  echo "$string"
done

while :; do echo "$((i++))"; done
\end{filecontents*}

\begin{filecontents*}[overwrite]{case.sh}
parse_argument(){ while [[ "$#" -gt 0 ]]; do
case $1 in
  --ant) antenna=$2; shift ;;
  -v) verbose=1; ;;
  *) echo unknown argument; ;;
esac
shift; done; echo "antenna:$antenna, verbose:$verbose"; }
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_fork.sh}
exec &> >(tee -a log.out)
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_fork_end.sh}
exec &> /dev/tty
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_open.sh}
exec 3<> filename
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_close.sh}
exec 3>&-
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_copy.sh}
exec 4>&3
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_write.sh}
echo "foo" >&3
\end{filecontents*}

\begin{filecontents*}[overwrite]{redir_read.sh}
cat <&3
\end{filecontents*}

\begin{filecontents*}[overwrite]{fork_pipe.sh}
shopt -s lastpipe; set +m  # permit last pipe command to execute in current shell; disable Monitor mode (i.e. job control)
{ echo -e "begin\ngrepme\nend" | tee /dev/fd/3 | sed -n '/grepme/p' | readarray -t a_filter; } 3>&1; echo "${a_filter[*]}"
\end{filecontents*}

\begin{filecontents*}[overwrite]{fork_join.sh}
for i in {0..9}; do ((i_fd=i+100))
   "exec $i_fd< <(echo message \"$i_fd\")"
done  `\small{\# Fork 10 subprocess}`

for i in {0..9}; do ((i_fd=i+100))
  a_out[$i]=$(cat <&"$i_fd")
done  `\small{\# Join and collect output}`

IFS=$'\n' echo "${a_out[*]}"  `\small{\# Print all outputs}`
\end{filecontents*}


% Last minute config
\setitemize[0]{leftmargin=*,parsep=0pt,itemsep=-20pt}
\newcommand{\mytitle}[1]{ \block{ #1 \rule{\textwidth}{0.4pt} } }

% =========================================================
% 0/ START
\begin{document}
\maketitle
\centering

% =========================================================
% A/ Syntax
\mytitle{ Grammar }

\begin{columns}

% A.1 Variable
\column{0.33}
\block{Variable}{
  \lstinputlisting{variable.sh}
  {\small
  \begin{itemize}
  
  \item \textbf{declare} is optional but adviced to enforce type.\\
  \item It can be replaced by \textbf{local} to limit its scope to the current function

  \end{itemize}
  }
}
\block{Function}{
  \lstinputlisting{function.sh}
}

% A.2 Condition
\column{0.33}
\block{Contition}{
  \lstinputlisting{condition.sh}
}
\block{Case}{
  \lstinputlisting{case.sh}
}

% A.3 Loop
\column{0.33}
\block{Loop}{
  \lstinputlisting{loop.sh}
  {\small
  }
}

\end{columns}

% =========================================================
% B/ Line
\mytitle{ Line }

\begin{columns}

% A.1 Variable
\column{0.25}
\block{Line}{
  \lstinputlisting{small_compgen.sh}
  \lstinputlisting{small_path.sh}
  \lstinputlisting{small_slurp.sh}
}

\column{0.50}
\block{}{
\begin{center}
\begin{tabular}{ |l|l|l|l| }
\textbf{Redirection}  & & \textbf{Substitution} & \\
\hline
\lstinputlisting{redir_fork.sh} & \small{Redirect stdout and stderr to file }
  & cell3 & cell4 \\
\lstinputlisting{redir_fork_end.sh} & \small{Reset stdout and stderr }
  & cell6 & cell7 \\
\lstinputlisting{redir_open.sh} & \small{Open FD}
  & cell6 & cell7 \\
\lstinputlisting{redir_close.sh} & \small{Close FD}
  & cell6 & cell7 \\
\lstinputlisting{redir_copy.sh} & \small{Copy FD 3 to 4}
  & cell6 & cell7 \\
\lstinputlisting{redir_write.sh} & \small{Write to FD}
  & cell6 & cell7 \\
\lstinputlisting{redir_read.sh} & \small{Read from FD}
  & cell6 & cell7 \\
\hline
\end{tabular}
\end{center}
}

\column{0.50}
\block{Fork a pipe}{
  \lstinputlisting{fork_pipe.sh}
}
\end{columns}

\block{Fork a pipe}{
  \lstinputlisting{fork_pipe.sh}
}

% =========================================================
% D/ Advanced
\mytitle{Advanced}{
}

\begin{columns}

% D.1 Large
\column{0.70}
\block{Hi}{
  \lstinputlisting{shbang.sh}
}
\block{Fork Join Processes}{
  \lstinputlisting{fork_join.sh}
}

% D.2 Small
\column{0.30}

\end{columns}

% =========================================================
% E/ Links
\block{Links}{
\begin{itemize}

\item \url{https://github.com/dylanaraps/pure-bash-bible}
\item \url{https://tldp.org/LDP/abs/abs-guide.pdf}
\item \url{git://git.savannah.gnu.org/bash.git}

\end{itemize}
}

\end{document}
